<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This posts will be continously updated, including intersting serach engine knowledge I found online, with introduction to Lucene">
<meta name="viewport" content="width=device-width">
<title>Search Engine Basics (Including Lucene) | Wendy's Corner</title>
<link href="//fonts.googleapis.com/css?family=Bitter:400,400i,700" rel="stylesheet" type="text/css">
<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
<link href="../../../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/main.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">
<link rel="canonical" href="https://www.pengyin-shan.com/posts/2015/Data%20Science/search-engine-basics-lucene/">
<link rel="icon" href="../../../../pengyin.ico" sizes="16x16">
<link rel="icon" href="../../../../pengyin.ico" sizes="128x128">
<!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]--><meta name="author" content="Pengyin(Wendy) Shan">
<meta property="og:site_name" content="Wendy's Corner">
<meta property="og:title" content="Search Engine Basics (Including Lucene)">
<meta property="og:url" content="https://www.pengyin-shan.com/posts/2015/Data%20Science/search-engine-basics-lucene/">
<meta property="og:description" content="This posts will be continously updated, including intersting serach engine knowledge I found online, with introduction to Lucene">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-07-21T00:00:00-04:00">
<meta property="article:tag" content="Data Science">
<meta property="article:tag" content="Hydra">
<meta property="article:tag" content="Search Engine">
<meta property="article:tag" content="SEO">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>
<body>
    <section class="social"><ul>
<li><a href="../../../../index.html" title="Home"><i class="fa fa-home"></i></a></li>
            <li><a href="../../../../aboutme/index.html" title="About me"><i class="fa fa-user"></i></a></li>
            <li><a href="../../../index.html" title="Posts"><i class="fa fa-folder-open"></i></a></li>
            <li><a href="../../../../categories/index.html" title="Tags"><i class="fa fa-tags"></i></a></li>
            <li><a href="../../../../rss.xml" title="RSS"><i class="fa fa-rss"></i></a></li>
            <li><a href="https://www.linkedin.com/in/pengyinshan/" title="My LinkedIn"><i class="fa fa-linkedin"></i></a></li>
            <li><a href="https://github.com/shanpy" title="My Github"><i class="fa fa-github"></i></a></li>

        </ul></section><section class="page-content"><div class="content" rel="main">
            <div class="container-fluid">
    <div class="post">
        <h1 class="p-name entry-title" itemprop="headline name">Search Engine Basics (Including Lucene)</h1>

        <div class="meta">
            <div class="authordate">
                <time class="timeago" datetime="2015-07-21T00:00:00-04:00">2015 Jul 21 </time>
            
                      |  
        <a href="../../Data%20Science/search-engine-basics-lucene/index.md" id="sourcelink">Source</a>

            </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../../../../categories/data-science/" rel="tag">Data Science</a></li>
           <li><a class="tag p-category" href="../../../../categories/hydra/" rel="tag">Hydra</a></li>
           <li><a class="tag p-category" href="../../../../categories/search-engine/" rel="tag">Search Engine</a></li>
           <li><a class="tag p-category" href="../../../../categories/seo/" rel="tag">SEO</a></li>
        </ul>
</div>

        </div>
        <div class="body">
            <div>
<h3 id="reference-list">Reference List</h3>
<ul>
<li><a href="http://www.tutorialspoint.com/lucene/lucene_overview.htm">Lucene Tutorial from TutorialPoint.com</a></li>
</ul>
<h3 id="search-engine-basics">Search Engine Basics</h3>
<h4 id="search-application-operation-list">Search Application Operation List</h4>
<ol>
<li>
<p><strong>Acquire Raw Content</strong>: Collect the target contents on which search are to be conducted.</p>
</li>
<li>
<p><strong>Build the document</strong>:  Build the document(s) from the raw contents which search application can understands and interpret easily.</p>
</li>
<li>
<p><strong>Analyze the document</strong>: The document is to be analyzed as which part of the text is a candidate to be indexed.</p>
</li>
<li>
<p><strong>Indexing the document</strong>: Index documents so that this document can be retrived based on certain keys instead of whole contents of the document.</p>
</li>
<li>
<p><strong>User Interface for Search</strong>: To facilitate user to make a search, application must provide a user a mean or u0ser interface where a user can enter text and start the search process.</p>
</li>
<li>
<p><strong>Build Query</strong>: Once user made a request to search a text, application should prepare a Query object using that text which can be used to inquire index database to get the relevant details.</p>
</li>
<li>
<p><strong>Search Query</strong>: Using query object, index database is then checked to get the relevant details and the content documents.</p>
</li>
<li>
<p><strong>Render Results</strong>: Once result is received the application should decide how to show the results to the user using User Interface. How much information is to be shown at first look and so on.</p>
</li>
</ol>
<h3 id="lucene-basics">Lucene Basics</h3>
<h4 id="setup">Setup</h4>
<p>Lucene performs step 2 to step 7 in <code>Search Application Operation List</code> section above.</p>
<p>You need <code>JDK</code> for Lucene setup. You can view setup process <a href="http://www.tutorialspoint.com/lucene/lucene_environment.htm">here</a>.</p>
<h4 id="index-process">Index Process</h4>
<p>In Lucene, <code>IndexWriter</code> is the most important and core component of the indexing process.</p>
<p>Process Chart for TutorialsPoint:</p>
<p>images/articles/2015/data/indexing_process.jpg </p>
<blockquote>
<p>We add Document(s) containing Field(s) to IndexWriter which analyzes the Document(s) using the Analyzer and then creates/open/edit indexes as required and store/update them in a Directory. IndexWriter is used to <em>update or create</em> indexes. It is not used to read indexes.</p>
</blockquote>
<h5 id="list-of-indexing-classes">List of Indexing Classes</h5>
<ol>
<li>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_indexwriter.htm">IndexWriter</a>: This class acts as a core component which <strong>creates/updates indexes</strong> during indexing process.</p>
</li>
<li>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_directory.htm">Directory</a>: This class represents the <strong>storage</strong> location of the indexes.</p>
</li>
<li>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_analyzer.htm">Analyzer</a>: Analyzer class is responsible to <strong>analyze</strong> a document and <strong>get the tokens/words from the text</strong> which is to be indexed. Without analysis done, IndexWriter can not create index.</p>
</li>
<li>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_document.htm">Document</a>: Document represents a <strong>virtual document</strong> with Fields where Field is object which can contain the physical document's contents, its meta data and so on. Analyzer can understand a Document only.</p>
</li>
<li>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_field.htm">Field</a>: Field is the <strong>lowest unit or the starting point</strong> of the indexing process. It represents the <code>key-value</code> pair relationship where a key is used to identify the value to be indexed. Say a field used to represent contents of a document will have key as "contents" and the value may contain the part or all of the text or numeric content of the document. Lucene can index only <strong>text or numeric</strong> contents only.</p>
</li>
</ol>
<h5 id="list-of-search-classes">List of Search Classes</h5>
<p>Searching process is again one of the core functionality provided by Lucene.</p>
<p>It's flow is similar to that of indexing process. Basic search of lucene can be made using following classes which can also be termed as foundation classes for all search related operations:</p>
<ol>
<li>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_indexsearcher.htm">IndexSearcher</a>: This class act as a core component which <strong>reads/searches indexes</strong> created after indexing process. It takes directory instance pointing to the location containing the indexes.</p>
</li>
<li>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_term.htm">Term</a>: This class is the <strong>lowest</strong> unit of searching. It is similar to Field in indexing process.</p>
</li>
<li>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_query.htm">Query</a>: Query is an abstract class and contains various utility methods and is the parent of all types of queries that lucene uses during search process.</p>
</li>
<li>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_termquery.htm">TermQuery</a>: TermQuery is the <strong>most commonly used query object</strong> and is the foundation of many complex queries that lucene can make use of.</p>
</li>
<li>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_topdocs.htm">TopDocs</a> : TopDocs points to the top N search results which matches the search criteria. It is simple container of pointers to point to documents which are output of search result.</p>
</li>
</ol>
<h5 id="create-a-document">Create a Document</h5>
<ol>
<li>
<p>Create a method to <strong>get a lucene document</strong> from a text file.</p>
</li>
<li>
<p>Create various types of fields which are <code>key-value</code> pairs containing keys as <strong>names</strong> and <strong>values</strong> as contents to be indexed.</p>
</li>
<li>
<p>Set field to be analyzed or not. In our case, only contents is to be analyzed as it can contain data such as <code>a</code>, <code>am</code>, <code>are</code>, <code>an</code> etc. which are not required in search operations.</p>
</li>
</ol>
<p>Example Code from TutorialsPoint:</p>
<pre class="code literal-block"><span></span><span class="kd">private</span> <span class="n">Document</span> <span class="nf">getDocument</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
    <span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">();</span>
    <span class="c1">//index file contents</span>
    <span class="n">Field</span> <span class="n">contentField</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Field</span><span class="o">(</span><span class="n">LuceneConstants</span><span class="o">.</span><span class="na">CONTENTS</span><span class="o">,</span> <span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
    <span class="c1">//index file name</span>
    <span class="n">Field</span> <span class="n">fileNameField</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Field</span><span class="o">(</span><span class="n">LuceneConstants</span><span class="o">.</span><span class="na">FILE_NAME</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">Field</span><span class="o">.</span><span class="na">Store</span><span class="o">.</span><span class="na">YES</span><span class="o">,</span> <span class="n">Field</span><span class="o">.</span><span class="na">Index</span><span class="o">.</span><span class="na">NOT_ANALYZED</span><span class="o">);</span>
    <span class="c1">//index file path</span>
    <span class="n">Field</span> <span class="n">filePathField</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Field</span><span class="o">(</span><span class="n">LuceneConstants</span><span class="o">.</span><span class="na">FILE_PATH</span><span class="o">,</span> <span class="n">file</span><span class="o">.</span><span class="na">getCanonicalPath</span><span class="o">(),</span> <span class="n">Field</span><span class="o">.</span><span class="na">Store</span><span class="o">.</span><span class="na">YES</span><span class="o">,</span><span class="n">Field</span><span class="o">.</span><span class="na">Index</span><span class="o">.</span><span class="na">NOT_ANALYZED</span><span class="o">);</span>
    <span class="n">document</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">contentField</span><span class="o">);</span>
    <span class="n">document</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">fileNameField</span><span class="o">);</span>
    <span class="n">document</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">filePathField</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">document</span><span class="o">;</span>
<span class="o">}</span>
</pre>


<h5 id="create-a-indexwriter">Create a IndexWriter</h5>
<ol>
<li>
<p>IndexWriter class acts as a core component which <strong>creates/updates</strong> indexes during indexing process.</p>
</li>
<li>
<p>Create object of <code>IndexWriter</code>.</p>
</li>
<li>
<p>Create a <code>lucene directory</code> which should point to location where indexes are to be stored.</p>
</li>
<li>
<p>Initialize the IndexWriter object created with the index directory, a standard analyzer having version information and other required/optional parameters.</p>
</li>
</ol>
<p>Example Code from TutorialsPoint:</p>
<pre class="code literal-block"><span></span><span class="kd">private</span> <span class="n">IndexWriter</span> <span class="n">writer</span><span class="o">;</span>
<span class="kd">public</span> <span class="nf">Indexer</span><span class="o">(</span><span class="n">String</span> <span class="n">indexDirectoryPath</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
   <span class="c1">//this directory will contain the indexes</span>
   <span class="n">Directory</span> <span class="n">indexDirectory</span> <span class="o">=</span> <span class="n">FSDirectory</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">indexDirectoryPath</span><span class="o">));</span>
   <span class="c1">//create the indexer</span>
   <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndexWriter</span><span class="o">(</span><span class="n">indexDirectory</span><span class="o">,</span> <span class="k">new</span> <span class="n">StandardAnalyzer</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">LUCENE_36</span><span class="o">),</span><span class="kc">true</span><span class="o">,</span> <span class="n">IndexWriter</span><span class="o">.</span><span class="na">MaxFieldLength</span><span class="o">.</span><span class="na">UNLIMITED</span><span class="o">);</span>
<span class="o">}</span>
</pre>


<h5 id="start-indexing-process">Start Indexing Process</h5>
<pre class="code literal-block"><span></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">indexFile</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Indexing "</span><span class="o">+</span><span class="n">file</span><span class="o">.</span><span class="na">getCanonicalPath</span><span class="o">());</span>
   <span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="n">getDocument</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
   <span class="n">writer</span><span class="o">.</span><span class="na">addDocument</span><span class="o">(</span><span class="n">document</span><span class="o">);</span>
<span class="o">}</span>
</pre>


<h4 id="basic-indexing-operations">Basic Indexing Operations</h4>
<h5 id="add-document-operation">Add Document Operation</h5>
<p>Add document is one of the core operation as part of indexing process.</p>
<ol>
<li>
<p><strong>Add a document to an index</strong>: Refer to <code>Create a Document</code> section above for process. After last step, add the newly created fields to the document object and return it to the caller method.</p>
</li>
<li>
<p><strong>Create a IndexWriter</strong>: Refer to <code>Create a IndexWriter</code> section above for process.</p>
</li>
<li>
<p><strong>Add document and start Indexing process</strong>: Two ways.</p>
</li>
</ol>
<blockquote>
<p>Way 1: <strong>addDocument(Document)</strong> - Adds the document using the default analyzer (specified when index writer is created.)</p>
<p>Way 2: <strong>addDocument(Document,Analyzer)</strong> - Adds the document using the provided analyzer.</p>
</blockquote>
<p>Refer "Start Indexing Process" section above for code reference.</p>
<h5 id="update-document-operation">Update Document Operation</h5>
<p>Update document is another important operation as part of indexing process.</p>
<p>This operation is used when already indexed contents are updated and indexes become invalid. This operation is also known as <code>re-indexing</code>.</p>
<p>We update Document(s) containing Field(s) to <code>IndexWriter</code> where <code>IndexWriter</code> is used to update indexes.</p>
<ol>
<li>
<strong>Update a document to an index</strong>: Create a method to update a lucene document from an updated text file.</li>
</ol>
<blockquote>
<pre class="code literal-block"><span></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">updateDocument</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
   <span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">();</span>
</pre>


</blockquote>
<pre class="code literal-block"><span></span>   //update indexes for file contents
   writer.updateDocument(new Term
      (LuceneConstants.CONTENTS,
      new FileReader(file)),document);
   writer.close();
}
</pre>


<ol>
<li>
<p><strong>Create a IndexWriter</strong>: Same as above.</p>
</li>
<li>
<p><strong>Update document and start reindexing process</strong>: Two Ways.</p>
</li>
</ol>
<blockquote>
<p>Way1: <strong>updateDocument(Term, Document)</strong>: <em>Delete</em> the document containing the term and <em>add</em> the document using the default analyzer (specified when index writer is created.)</p>
<p>Way2: <strong>updateDocument(Term, Document,Analyzer)</strong>: <em>Delete</em> the document containing the term and <em>add</em> the document using the provided analyzer.</p>
<pre class="code literal-block"><span></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">indexFile</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Updating index for "</span><span class="o">+</span><span class="n">file</span><span class="o">.</span><span class="na">getCanonicalPath</span><span class="o">());</span>
   <span class="n">updateDocument</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
<span class="o">}</span>
</pre>


</blockquote>
<h5 id="delete-document-operation">Delete Document Operation</h5>
<p>Delete document is another important operation as part of indexing process.</p>
<p>This operation is used when already indexed contents are updated and indexes become invalid or indexes become very large in size then <em>in order to reduce the size and update the index</em>, delete operations are carried out.</p>
<p>We delete Document(s) containing Field(s) to <code>IndexWriter</code> where <code>IndexWriter</code> is used to update indexes.</p>
<ol>
<li>
<strong>Delete a document from an index</strong> : Create a method to delete a lucene document of an obsolete text file.</li>
</ol>
<blockquote>
<pre class="code literal-block"><span></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">deleteDocument</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
   <span class="c1">//delete indexes for a file</span>
   <span class="n">writer</span><span class="o">.</span><span class="na">deleteDocument</span><span class="o">(</span><span class="k">new</span> <span class="n">Term</span><span class="o">(</span><span class="n">LuceneConstants</span><span class="o">.</span><span class="na">FILE_NAME</span><span class="o">,</span><span class="n">file</span><span class="o">.</span><span class="na">getName</span><span class="o">()));</span>
   <span class="n">writer</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>
   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"index contains deleted files: "</span><span class="o">+</span><span class="n">writer</span><span class="o">.</span><span class="na">hasDeletions</span><span class="o">());</span>
   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"index contains documents: "</span><span class="o">+</span><span class="n">writer</span><span class="o">.</span><span class="na">maxDoc</span><span class="o">());</span>
   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"index contains deleted documents: "</span><span class="o">+</span><span class="n">writer</span><span class="o">.</span><span class="na">numDoc</span><span class="o">());</span>
<span class="o">}</span>
</pre>


</blockquote>
<ol>
<li>
<p><strong>Create a IndexWriter</strong>: Same as above</p>
</li>
<li>
<p><strong>Delete document and start reindexing process</strong>: Five ways.</p>
</li>
</ol>
<blockquote>
<p>Way1: <strong>deleteDocuments(Term)</strong>: Delete all the documents containing the term.</p>
<p>Way2: <strong>deleteDocuments(Term[])</strong>: Delete all the documents containing any of the terms in the array.</p>
<p>Way3: <strong>deleteDocuments(Query)</strong>: Delete all the documents matching the query.</p>
<p>Way4: <strong>deleteDocuments(Query[])</strong>: Delete all the documents matching the query in the array.</p>
<p>Way5: <strong>deleteAll</strong>: Delete all the documents.</p>
</blockquote>
<pre class="code literal-block"><span></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">indexFile</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Deleting index for "</span><span class="o">+</span><span class="n">file</span><span class="o">.</span><span class="na">getCanonicalPath</span><span class="o">());</span>
   <span class="n">deleteDocument</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
<span class="o">}</span>
</pre>


<h5 id="field-options">Field Options</h5>
<p>Field is the most important and the foundation unit of indexing process.</p>
<p>It is the actual object containing the contents to be indexed. When we add a field, lucene provides numerous controls on the field using Field Options which states how much a field is to be searchable.</p>
<p>We add Document(s) containing Field(s) to <code>IndexWriter</code> where <code>IndexWriter</code> is used to update or create indexes.</p>
<h6 id="list-of-field-options">List of Field Options</h6>
<ul>
<li>
<p><code>Index.ANALYZED</code>: First analyze then do indexing. Used for <em>normal text indexing</em>. Analyzer will break the field's value into stream of tokens and each token is searcable sepearately.</p>
</li>
<li>
<p><code>Index.NOT_ANALYZED</code>: Don't analyze but do indexing. Used for <em>complete text indexing</em> *for example person's names, URL etc.</p>
</li>
<li>
<p><code>Index.ANALYZED_NO_NORMS</code>: Varient of <code>Index.ANALYZED</code>. Analyzer will <em>break the field's value into stream of tokens</em> and each token is searcable sepearately but <code>NORMs</code> are not stored in the indexes. <code>NORMS</code> are used to boost searching but are sometime memory consuming.</p>
</li>
<li>
<p><code>Index.Index.NOT_ANALYZED_NO_NORMS</code>:  Varient of <code>Index.NOT_ANALYZED</code>. Indexing is done but NORMS are not stored in the indexes.</p>
</li>
<li>
<p><code>Index.NO</code>: Field value is not searchable.</p>
</li>
</ul>
<h6 id="use-of-field-options">Use of Field Options</h6>
<ol>
<li>
<p>Same steps as <code>Create a Document</code> section</p>
</li>
<li>
<p>Add the newly created fields to the document object and return it to the caller method.</p>
</li>
</ol>
<h4 id="search-operations">Search Operations</h4>
<p>Searching process is one of the core functionality provided by Lucene.</p>
<p><code>IndexSearcher</code> is the most important and core component of the searching process.</p>
<p>Process Chart for TutorialsPoint:</p>
<p>images/articles/2015/data/searching_process.jpg </p>
<p>We first create <code>Directory</code>(s) containing <code>index</code>es and then pass it to <code>IndexSearcher</code> which opens the <code>Directory</code> using <code>IndexReader</code>.</p>
<p>Then we create a <code>Query</code> with a <code>Term</code> and make a search using <code>IndexSearcher</code> by passing the <code>Query</code> to the searcher.</p>
<p><code>IndexSearcher</code> returns a <code>TopDocs</code> object which contains the search details along with document <code>ID</code>(s) of the Document which is the result of the search operation.</p>
<h5 id="create-a-queryparser">Create a QueryParser</h5>
<ol>
<li>
<p>QueryParser class parses the user entered input into <strong>lucene understandable format query</strong>.</p>
</li>
<li>
<p>Create object of <code>QueryParser</code>.</p>
</li>
<li>
<p>Initialize the QueryParser object created with a standard analyzer having version information and index name on which this query is to run.</p>
</li>
</ol>
<blockquote>
<pre class="code literal-block"><span></span><span class="n">QueryParser</span> <span class="n">queryParser</span><span class="o">;</span>
<span class="kd">public</span> <span class="nf">Searcher</span><span class="o">(</span><span class="n">String</span> <span class="n">indexDirectoryPath</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
   <span class="n">queryParser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryParser</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">LUCENE_36</span><span class="o">,</span>
      <span class="n">LuceneConstants</span><span class="o">.</span><span class="na">CONTENTS</span><span class="o">,</span>
         <span class="k">new</span> <span class="n">StandardAnalyzer</span><span class="o">(</span><span class="n">Version</span><span class="o">.</span><span class="na">LUCENE_36</span><span class="o">));</span>
<span class="o">}</span>
</pre>


</blockquote>
<h5 id="create-a-indexsearch">Create a IndexSearch</h5>
<ol>
<li>
<p><code>IndexSearcher</code> class acts as a core component which searcher indexes created during indexing process.</p>
</li>
<li>
<p>Create object of <code>IndexSearcher</code>.</p>
</li>
<li>
<p>Create a <strong>lucene directory</strong> which should point to location where indexes are to be stored.</p>
</li>
<li>
<p>Initialize the <code>IndexSearcher</code> object created with the index directory</p>
</li>
</ol>
<blockquote>
<pre class="code literal-block"><span></span><span class="n">IndexSearcher</span> <span class="n">indexSearcher</span><span class="o">;</span>
<span class="kd">public</span> <span class="nf">Searcher</span><span class="o">(</span><span class="n">String</span> <span class="n">indexDirectoryPath</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
   <span class="n">Directory</span> <span class="n">indexDirectory</span> <span class="o">=</span>
      <span class="n">FSDirectory</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">indexDirectoryPath</span><span class="o">));</span>
   <span class="n">indexSearcher</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IndexSearcher</span><span class="o">(</span><span class="n">indexDirectory</span><span class="o">);</span>
<span class="o">}</span>
</pre>


</blockquote>
<h5 id="make-search">Make search</h5>
<ul>
<li>
<p>To start search, create a <code>Query</code> object by parsing search expression through QueryParser.</p>
</li>
<li>
<p>Make search by calling `IndexSearcher.search()`` method.</p>
</li>
</ul>
<blockquote>
<pre class="code literal-block"><span></span><span class="n">Query</span> <span class="n">query</span><span class="o">;</span>
<span class="kd">public</span> <span class="n">TopDocs</span> <span class="nf">search</span><span class="o">(</span> <span class="n">String</span> <span class="n">searchQuery</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span><span class="n">ParseException</span><span class="o">{</span>
   <span class="n">query</span> <span class="o">=</span> <span class="n">queryParser</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">searchQuery</span><span class="o">);</span>
   <span class="k">return</span> <span class="n">indexSearcher</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">query</span><span class="o">,</span> <span class="n">LuceneConstants</span><span class="o">.</span><span class="na">MAX_SEARCH</span><span class="o">);</span>
<span class="o">}</span>
</pre>


</blockquote>
<h5 id="get-the-document">Get the document</h5>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="n">Document</span> <span class="nf">getDocument</span><span class="o">(</span><span class="n">ScoreDoc</span> <span class="n">scoreDoc</span><span class="o">)</span>
   <span class="kd">throws</span> <span class="n">CorruptIndexException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">{</span>
   <span class="k">return</span> <span class="n">indexSearcher</span><span class="o">.</span><span class="na">doc</span><span class="o">(</span><span class="n">scoreDoc</span><span class="o">.</span><span class="na">doc</span><span class="o">);</span>
<span class="o">}</span>
</pre>


<h5 id="close-indexsearcher">Close IndexSearcher</h5>
<pre class="code literal-block"><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>
   <span class="n">indexSearcher</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre>


<h4 id="query-programming">Query Programming</h4>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_termquery1.htm">TermQuery</a>: TermQuery is the most commonly used query object and is the foundation of many complex queries that lucene can make use of. TermQuery is normally used to retrieve documents based on the key which is case sensitive.</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_termrangequery.htm">TermRangeQuery</a>: TermRangeQuery is the used when a range of textual terms are to be searched.</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_prefixquery.htm">PrefixQuery</a>: PrefixQuery is used to match documents whose <em>index starts with a specified string</em>.</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_booleanquery.htm">BooleanQuery</a>: BooleanQuery is used to search documents which are result of multiple queries using <code>AND</code>, <code>OR</code> or <code>NOT</code> operators.</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_phrasequery.htm">PhraseQuery</a>: Phrase query is used to search documents which contain a particular sequence of terms.</p>
<p>WhildCardQuery: WildcardQuery is used to search documents using wildcards like <code>*</code> for any character sequence,<code>?</code> matching a single character.</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_fuzzyquery.htm">FuzzyQuery</a>: FuzzyQuery is used to search documents using <strong>fuzzy implementation</strong> that is an approximate search based on edit distance algorithm.</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_matchalldocsquery.htm">MatchAllDocsQuery</a>: MatchAllDocsQuery as name suggests <em>matches all the documents</em>.</p>
<h4 id="analysis-objects">Analysis Objects</h4>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_token.htm">Token</a>: Token represents text or word in a document with relevant details like its <strong>metadata</strong> (position, start offset, end offset, token type and its position increment).</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_tokenstream.htm">TokenStream</a>: TokenStream is an output of analysis process and it comprises of series of tokens. It is an abstract class.</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_analyzer_class.htm">Analyzer</a>: Analyzer class is responsible to analyze a document and get the tokens/words from the text which is to be indexed. Without analysis done, IndexWriter can not create index.</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_whitespaceanalyzer.htm">WhitespaceAnalyzer</a>: This analyzer spilts the text in a document based on <strong>whitespace</strong>.</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_simpleanalyzer.htm">SimpleAnalyzer</a>: This analyzer spilts the text in a document based on <strong>non-letter characters</strong> and then lowercase them.</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_stopanalyzer.htm">StopAnalyzer</a>: This analyzer works similar to SimpleAnalyzer and remove the common words like <code>a</code>,<code>an</code>,<code>the</code> etc.</p>
<p><a href="http://www.tutorialspoint.com/lucene/lucene_standardanalyzer.htm">StandardAnalyzer</a>: This is the most sofisticated analyzer and is capable of handling <code>names</code>, <code>email address</code> etc. It lowercases each token and removes common words and punctuation if any.</p>
<h4 id="sorting">Sorting</h4>
<h5 id="sorting-by-relevance">Sorting By Relevance</h5>
<p>This is <strong>default</strong> sorting mode used by lucene.</p>
<p>Lucene provides results by the most relevant hit at the top.</p>
<p>Example Code from TutorialsPoint:</p>
<pre class="code literal-block"><span></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">sortUsingRelevance</span><span class="o">(</span><span class="n">String</span> <span class="n">searchQuery</span><span class="o">)</span>
 <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ParseException</span><span class="o">{</span>
   <span class="n">searcher</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Searcher</span><span class="o">(</span><span class="n">indexDir</span><span class="o">);</span>
   <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
   <span class="c1">//create a term to search file name</span>
   <span class="n">Term</span> <span class="n">term</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Term</span><span class="o">(</span><span class="n">LuceneConstants</span><span class="o">.</span><span class="na">FILE_NAME</span><span class="o">,</span> <span class="n">searchQuery</span><span class="o">);</span>
   <span class="c1">//create the term query object</span>
   <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FuzzyQuery</span><span class="o">(</span><span class="n">term</span><span class="o">);</span>
   <span class="n">searcher</span><span class="o">.</span><span class="na">setDefaultFieldSortScoring</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
   <span class="c1">//do the search</span>
   <span class="n">TopDocs</span> <span class="n">hits</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">query</span><span class="o">,</span><span class="n">Sort</span><span class="o">.</span><span class="na">RELEVANCE</span><span class="o">);</span>
   <span class="kt">long</span> <span class="n">endTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">hits</span><span class="o">.</span><span class="na">totalHits</span> <span class="o">+</span>
      <span class="s">" documents found. Time :"</span> <span class="o">+</span> <span class="o">(</span><span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">)</span> <span class="o">+</span> <span class="s">"ms"</span><span class="o">);</span>
   <span class="k">for</span><span class="o">(</span><span class="n">ScoreDoc</span> <span class="n">scoreDoc</span> <span class="o">:</span> <span class="n">hits</span><span class="o">.</span><span class="na">scoreDocs</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="na">getDocument</span><span class="o">(</span><span class="n">scoreDoc</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Score: "</span><span class="o">+</span> <span class="n">scoreDoc</span><span class="o">.</span><span class="na">score</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"File: "</span><span class="o">+</span> <span class="n">doc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">LuceneConstants</span><span class="o">.</span><span class="na">FILE_PATH</span><span class="o">));</span>
   <span class="o">}</span>
   <span class="n">searcher</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre>


<h5 id="sorting-by-indexorder">Sorting By IndexOrder</h5>
<p>This is sorting mode used by lucene in which first document indexed is shown first in the search results.</p>
<pre class="code literal-block"><span></span><span class="kd">private</span> <span class="kt">void</span> <span class="nf">sortUsingIndex</span><span class="o">(</span><span class="n">String</span> <span class="n">searchQuery</span><span class="o">)</span>
 <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ParseException</span><span class="o">{</span>
   <span class="n">searcher</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Searcher</span><span class="o">(</span><span class="n">indexDir</span><span class="o">);</span>
   <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
   <span class="c1">//create a term to search file name</span>
   <span class="n">Term</span> <span class="n">term</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Term</span><span class="o">(</span><span class="n">LuceneConstants</span><span class="o">.</span><span class="na">FILE_NAME</span><span class="o">,</span> <span class="n">searchQuery</span><span class="o">);</span>
   <span class="c1">//create the term query object</span>
   <span class="n">Query</span> <span class="n">query</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FuzzyQuery</span><span class="o">(</span><span class="n">term</span><span class="o">);</span>
   <span class="n">searcher</span><span class="o">.</span><span class="na">setDefaultFieldSortScoring</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
   <span class="c1">//do the search</span>
   <span class="n">TopDocs</span> <span class="n">hits</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">query</span><span class="o">,</span><span class="n">Sort</span><span class="o">.</span><span class="na">INDEXORDER</span><span class="o">);</span>
   <span class="kt">long</span> <span class="n">endTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
   <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">hits</span><span class="o">.</span><span class="na">totalHits</span> <span class="o">+</span>
      <span class="s">" documents found. Time :"</span> <span class="o">+</span> <span class="o">(</span><span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">)</span> <span class="o">+</span> <span class="s">"ms"</span><span class="o">);</span>
   <span class="k">for</span><span class="o">(</span><span class="n">ScoreDoc</span> <span class="n">scoreDoc</span> <span class="o">:</span> <span class="n">hits</span><span class="o">.</span><span class="na">scoreDocs</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">searcher</span><span class="o">.</span><span class="na">getDocument</span><span class="o">(</span><span class="n">scoreDoc</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"Score: "</span><span class="o">+</span> <span class="n">scoreDoc</span><span class="o">.</span><span class="na">score</span> <span class="o">+</span> <span class="s">" "</span><span class="o">);</span>
      <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"File: "</span><span class="o">+</span> <span class="n">doc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">LuceneConstants</span><span class="o">.</span><span class="na">FILE_PATH</span><span class="o">));</span>
   <span class="o">}</span>
   <span class="n">searcher</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre>
</div>
        </div>
                <ul class="pager hidden-print">
<li class="previous">
                <a href="../../Others/rdf-basics/" rel="prev" title="RDF Basics">Previous post</a>
            </li>
            <li class="next">
                <a href="../../Java/junit-basics/" rel="next" title="JUnit Basics">Next post</a>
            </li>
        </ul>
<div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="pengyinsnotes",
            disqus_url="https://www.pengyin-shan.com/posts/2015/Data%20Science/search-engine-basics-lucene/",
        disqus_title="Search Engine Basics (Including Lucene)",
        disqus_identifier="cache/posts/2015/Data Science/search-engine-basics-lucene.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    </div>
                        <footer id="footer"><p>Contents © 2019         <a href="mailto:pengyin.shan@outlook.com">Pengyin(Wendy) Shan</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
        </div>
    </section><script src="../../../../assets/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="../../../../assets/js/jquery.timeago.js" type="text/javascript"></script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script><script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$latex ','$'], ['\\(','\\)']]}});
    </script><script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.6.3/jquery.timeago.js"></script>
</body>
</html>
